---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: imageregistries.registry.lookout.dev
spec:
  group: registry.lookout.dev
  names:
    kind: ImageRegistry
    listKind: ImageRegistryList
    plural: imageregistries
    shortNames:
    - ir
    - imgreg
    singular: imageregistry
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.type
      name: Type
      type: string
    - jsonPath: .status.conditions[?(@.type=="Ready")].status
      name: Ready
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ImageRegistry is the Schema for the imageregistries API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: Spec defines the desired state of ImageRegistry
            properties:
              acr:
                description: ACR contains Azure Container Registry configuration
                properties:
                  registryName:
                    description: RegistryName is the ACR registry name
                    type: string
                  resourceGroup:
                    description: ResourceGroup is the Azure resource group
                    type: string
                  subscriptionId:
                    description: SubscriptionID is the Azure subscription ID
                    type: string
                required:
                - registryName
                - resourceGroup
                - subscriptionId
                type: object
              auth:
                description: Auth defines authentication configuration
                properties:
                  secretRef:
                    description: SecretRef references a Kubernetes secret containing
                      credentials
                    properties:
                      key:
                        description: Key is the specific key in the secret (for service
                          account JSON, etc.)
                        type: string
                      name:
                        description: Name is the name of the secret
                        type: string
                      namespace:
                        description: Namespace is the namespace of the secret (defaults
                          to ImageRegistry namespace)
                        type: string
                    required:
                    - name
                    type: object
                  serviceAccountRef:
                    description: ServiceAccountRef references a service account for
                      token-based auth
                    properties:
                      key:
                        description: Key is the specific key in the secret (for service
                          account JSON, etc.)
                        type: string
                      name:
                        description: Name is the name of the secret
                        type: string
                      namespace:
                        description: Namespace is the namespace of the secret (defaults
                          to ImageRegistry namespace)
                        type: string
                    required:
                    - name
                    type: object
                  workloadIdentity:
                    description: WorkloadIdentity uses cloud-native workload identity
                      (IRSA, GCP Workload Identity, etc.)
                    properties:
                      enabled:
                        default: false
                        description: Enabled enables workload identity (IRSA for AWS,
                          Workload Identity for GCP, etc.)
                        type: boolean
                    type: object
                type: object
              circuitBreaker:
                description: CircuitBreaker defines circuit breaker settings
                properties:
                  enabled:
                    default: true
                    description: Enabled enables the circuit breaker
                    type: boolean
                  failureThreshold:
                    default: 5
                    description: FailureThreshold is the number of failures before
                      opening the circuit
                    minimum: 1
                    type: integer
                  successThreshold:
                    default: 2
                    description: SuccessThreshold is the number of successes before
                      closing the circuit
                    minimum: 1
                    type: integer
                  timeout:
                    default: 5m
                    description: Timeout is the time to wait before transitioning
                      from open to half-open
                    type: string
                type: object
              dockerHub:
                description: DockerHub contains DockerHub-specific configuration
                properties:
                  organization:
                    description: Organization is the DockerHub organization (optional)
                    type: string
                type: object
              ecr:
                description: ECR contains ECR-specific configuration
                properties:
                  accountId:
                    description: AccountID is the AWS account ID (optional, auto-detected
                      if not specified)
                    type: string
                  region:
                    description: Region is the AWS region where ECR is located
                    type: string
                required:
                - region
                type: object
              gcr:
                description: GCR contains Google Container Registry configuration
                properties:
                  location:
                    default: us
                    description: Location is the GCR location (eu, us, asia, or specific
                      region)
                    type: string
                  project:
                    description: Project is the GCP project ID
                    type: string
                required:
                - project
                type: object
              generic:
                description: Generic contains generic OCI registry configuration
                properties:
                  apiVersion:
                    default: v2
                    description: APIVersion is the Docker Registry API version
                    type: string
                  url:
                    description: URL is the registry URL
                    pattern: ^https?://
                    type: string
                required:
                - url
                type: object
              harbor:
                description: Harbor contains Harbor-specific configuration
                properties:
                  insecureSkipVerify:
                    description: InsecureSkipVerify skips TLS verification (not recommended
                      for production)
                    type: boolean
                  project:
                    description: Project is the default Harbor project
                    type: string
                  url:
                    description: URL is the Harbor server URL
                    pattern: ^https?://
                    type: string
                required:
                - url
                type: object
              rateLimiting:
                description: RateLimiting defines rate limiting settings
                properties:
                  burst:
                    default: 20
                    description: Burst is the maximum burst size
                    maximum: 200
                    minimum: 1
                    type: integer
                  requestsPerSecond:
                    default: 10
                    description: RequestsPerSecond is the maximum requests per second
                    maximum: 100
                    minimum: 1
                    type: integer
                type: object
              scan:
                description: Scan defines image scanning configuration
                properties:
                  defaultInterval:
                    default: 5m
                    description: DefaultInterval is the default polling interval
                    type: string
                  minInterval:
                    default: 1m
                    description: MinInterval is the minimum polling interval (workloads
                      can't go below this)
                    type: string
                  sortBy:
                    default: pushedAt
                    description: SortBy defines how to sort tags when fetching
                    enum:
                    - pushedAt
                    - tagName
                    type: string
                  tagLimit:
                    default: 100
                    description: TagLimit is the maximum number of tags to fetch per
                      repository
                    maximum: 1000
                    minimum: 10
                    type: integer
                type: object
              tls:
                description: TLS defines TLS configuration
                properties:
                  caSecretRef:
                    description: CASecretRef references a secret containing CA certificate
                    properties:
                      key:
                        description: Key is the specific key in the secret (for service
                          account JSON, etc.)
                        type: string
                      name:
                        description: Name is the name of the secret
                        type: string
                      namespace:
                        description: Namespace is the namespace of the secret (defaults
                          to ImageRegistry namespace)
                        type: string
                    required:
                    - name
                    type: object
                  insecureSkipVerify:
                    description: InsecureSkipVerify skips TLS verification (not recommended
                      for production)
                    type: boolean
                type: object
              type:
                description: Type is the registry type (ecr, harbor, dockerhub, gcr,
                  acr, quay, generic)
                enum:
                - ecr
                - harbor
                - dockerhub
                - gcr
                - acr
                - quay
                - generic
                type: string
            required:
            - type
            type: object
          status:
            description: Status defines the observed state of ImageRegistry
            properties:
              auth:
                description: Auth is the current authentication status
                properties:
                  expiresAt:
                    description: ExpiresAt is when the credentials expire (if known)
                    format: date-time
                    type: string
                  lastValidated:
                    description: LastValidated is the last time authentication was
                      validated
                    format: date-time
                    type: string
                  valid:
                    description: Valid indicates if authentication is valid
                    type: boolean
                type: object
              circuitBreaker:
                description: CircuitBreaker is the current circuit breaker status
                properties:
                  failures:
                    description: Failures is the current failure count
                    type: integer
                  lastFailure:
                    description: LastFailure is the time of the last failure
                    format: date-time
                    type: string
                  state:
                    description: State is the current circuit breaker state
                    type: string
                type: object
              conditions:
                description: Conditions represent the current state of the ImageRegistry
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              lastConnectedAt:
                description: LastConnectedAt is the last successful connection time
                format: date-time
                type: string
              observedGeneration:
                description: ObservedGeneration is the last observed generation
                format: int64
                type: integer
              trackedRepositories:
                description: TrackedRepositories are the repositories being tracked
                items:
                  description: TrackedRepository represents a repository being tracked
                  properties:
                    fullPath:
                      description: FullPath is the full repository path including
                        registry
                      type: string
                    lastScanAt:
                      description: LastScanAt is the last successful scan time
                      format: date-time
                      type: string
                    latestTag:
                      description: LatestTag is the latest tag found (according to
                        policy)
                      type: string
                    name:
                      description: Name is the repository name
                      type: string
                    tagCount:
                      description: TagCount is the number of tags found
                      type: integer
                    watcherCount:
                      description: WatcherCount is the number of workloads watching
                        this repository
                      type: integer
                  required:
                  - fullPath
                  - name
                  type: object
                type: array
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
